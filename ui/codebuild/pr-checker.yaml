version: 0.2

phases:
  install:
    commands:
      - echo "Checking for changes in the target directory..."
      # List files changed in the latest commit and filter by path
      - CHANGED_FILES=$(git diff --name-only HEAD~1 HEAD)
  pre_build:
    commands:
      - |
        if echo "$CHANGED_FILES" | grep -q "ui/"; then
          echo "Relevant files have changed. Proceeding with build."
          export RUN_BUILD=true
        else
          echo "No relevant files changed. Skipping build."
          export RUN_BUILD=false
        fi
  build:
    commands:
      - |
        if [ "$RUN_BUILD" = "true" ]; then
          echo build started on `date`
          cd ui
          npm i
          npm run test
          npm run format:check
        else
          echo "Skipping build phase as no relevant files were changed."
        fi
  post_build:
    commands:
      - echo "Build completed."
